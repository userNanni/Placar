<!DOCTYPE html>
<html lang="pt">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Placar OHMA</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Old+Standard+TT:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/pocketbase@0.19.0/dist/pocketbase.umd.js"></script>
  <style>
    @keyframes pontuacaoPulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.3); opacity: 0.7; }
      100% { transform: scale(1); opacity: 1; }
    }
    @keyframes elasticStop {
      0% { transform: scale(1); }
      60% { transform: scale(1.3); }
      80% { transform: scale(0.95); }
      100% { transform: scale(1); }
    }

    .pontuacao-elastica { animation: elasticStop 1s ease-out; }
    .highlight { background: #e8d9b5 !important; box-shadow: 0 0 15px rgba(218, 165, 32, 0.6) !important; }
    .first-place-change { background: #d4af37 !important; color: #956a04 !important; }

    body {
      font-family: 'Old Standard TT', serif;
      text-align: center;
      margin: 0;
      padding: 0;
      background: url('https://www.transparenttextures.com/patterns/old-paper.png'), #394059;
      color: #394059;
      min-height: 100vh;
    }

    .container {
      max-width: 2500px;
      margin: 30px auto;
      background-image: url("https://www.transparenttextures.com/patterns/parchment.png");
      padding-right: 50px;
      padding-bottom: 0px;
      border-radius: 5px;
      box-shadow: 0 0 0px rgba(139, 69, 19, 0.6);
      
    }

    h2 {
      font-family: 'Cinzel', serif;
      font-size: 2rem;
      color: #5c3a21;
      margin-bottom: 30px;
    }

    .columns {
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .col {
      display: flex;
      flex-direction: column;
      gap: 20px;
      flex: 1;
    }

    .team {
  display: flex;
  align-items: center;
  background: rgba(255, 253, 245, 0.95);
  border: 2px solid #c9b18b;
  border-radius: 10px;
  padding: 20px;
  height: 220px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  flex-direction: row;
  justify-content: space-between;
  transition: 2s ease; 
}

    .team:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 10px rgba(0,0,0,0.2);
    }

    .team img.team-main {
      width: 150px;
      height: 150px;
      border-radius: 30%;
      border: 3px solid #8B4513;
      object-fit: cover;
      margin-right: 20px;
      margin-left: 20px;
      padding-left: 2px;
      background: #fff;
    }

    .team img.team-brasao {
  width: 85px;
  height: 85px;
  object-fit: contain;
  margin-left: 15px;
  margin-right: 10px;
  align-self: center;
}

.team-name {
  font-family: 'Arial', serif;
  font-size: 55px;
  color: #5c3a21;
  display: flex;
  align-items: center;
  font-weight: bold;
  gap: 8px;
}

    .team-points {
      font-size: 4rem;
      font-weight: bold;
      color: #8B0000;
    }

    .team-info {
    display: flex;
      align-items: center;
     
  
    }
    .team-position-number {
  font-weight: bold;
  color: #8B4513;
  font-size: 4rem;
}

    /* Responsivo */
    @media (max-width: 768px) {
      .columns {
        flex-direction: column;
        align-items: center;
      }

      .col {
        width: 100%;
        max-width: 400px;
      }
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

</head>
<body>
  <div class="container">
  
    <div class="columns">
      <ul id="col-1" class="col"></ul>
      <ul id="col-2" class="col"></ul>
    </div>
  </div>

  <script>
    const pb = new PocketBase("https://simplyheron.fly.dev");
    
    let previousPoints = {};
    let previousFirstPlace = null;
    let previousOrder = [];
    
    async function fetchTeams() {
  try {
    const response = await pb.collection("placar").getFullList({ sort: "-pontos" });

    const sorted = Object.entries(response.reduce((acc, record) => {
      acc[record.equipe] = {
        pontos: record.pontos,
        imagem: record.imagem ? pb.files.getUrl(record, record.imagem) : "https://via.placeholder.com/70",
        brasao: record.imagem2 ? pb.files.getUrl(record, record.imagem2) : "https://via.placeholder.com/20"
      };
      return acc;
    }, {})).sort((a, b) => b[1].pontos - a[1].pontos);

    const top6 = sorted.slice(0, 6);
    const col1 = document.getElementById("col-1");
    const col2 = document.getElementById("col-2");
    col1.innerHTML = "";
    col2.innerHTML = "";

    const currentOrder = top6.map(([name]) => name);
    const indexMap = Object.fromEntries(currentOrder.map((name, i) => [name, i]));

    top6.forEach(([name, data], index) => {
      const li = document.createElement("li");
      li.className = "team";
      li.dataset.team = name;

      const link = document.createElement("a");
link.href = `equipe.html?id=${encodeURIComponent(name)}`;
link.style.textDecoration = "none";
link.style.color = "inherit";
link.appendChild(li);

      const teamInfo = document.createElement("div");
      teamInfo.className = "team-info";

      const img = document.createElement("img");
      img.src = data.imagem;
      img.className = "team-main";
      img.alt = name;

      const nameSpan = document.createElement("div");
      nameSpan.className = "team-name";

      const positionLabel = document.createElement("span");
      positionLabel.className = "team-position-number";
      positionLabel.textContent = `${index + 1}º`;

      const nameText = document.createElement("span");
      nameText.textContent = name;

      nameSpan.appendChild(positionLabel);
      nameSpan.appendChild(nameText);

      const brasao = document.createElement("img");
      brasao.src = data.brasao;
      brasao.className = "team-brasao";
      brasao.alt = "Brasão";

      teamInfo.appendChild(img);
      teamInfo.appendChild(nameSpan);
      teamInfo.appendChild(brasao);

      const points = document.createElement("div");
      points.className = "team-points";
      points.textContent = `${data.pontos} pts`;

      li.appendChild(teamInfo);
      li.appendChild(points);

      // ANIMAÇÃO DE MOVIMENTO
      const previousIndex = previousOrder.indexOf(name);
      if (previousIndex !== -1 && previousIndex !== index) {
        const offset = (previousIndex - index) * 160;
        li.style.transform = `translateY(${offset}px)`;
        li.style.transition = "transform 2s ease";//
        setTimeout(() => {
          li.style.transform = "translateY(0)";
        }, 100);
      }

      // Insere na coluna correta
      (index < 3 ? col1 : col2).appendChild(link);

      // Animação de pontos
      if (previousPoints[name] !== undefined && previousPoints[name] !== data.pontos) {
        li.classList.add("highlight");
        let atual = 0;
        let final = data.pontos;
        let embaralhador = setInterval(() => {
          atual = Math.floor(Math.random() * 1000);
          points.textContent = `${atual} pts`;
        }, 60);

        setTimeout(() => {
          clearInterval(embaralhador);
          points.textContent = `${final} pts`;
          points.classList.add("pontuacao-elastica");
          setTimeout(() => {
            points.classList.remove("pontuacao-elastica");
            li.classList.remove("highlight");
          }, 1000);
        }, 2000);
      }

      // Destaque novo primeiro lugar
      if (index === 0 && previousFirstPlace && previousFirstPlace !== name) {
        li.classList.add("first-place-change");
        setTimeout(() => li.classList.remove("first-place-change"), 3000);
      }

      previousPoints[name] = data.pontos;
    });

    previousFirstPlace = top6.length > 0 ? top6[0][0] : null;
    previousOrder = currentOrder;
  } catch (err) {
    console.error("Erro:", err);
  }
}

    
    async function subscribeToUpdates() {
      pb.collection("placar").subscribe("*", () => fetchTeams());
    }
    
    fetchTeams();
    subscribeToUpdates();
    

    </script>
    
</body>


</html>

